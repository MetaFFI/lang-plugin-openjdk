package main

import (
	"encoding/json"
	compiler "github.com/OpenFFI/plugin-sdk/compiler/go"
	"os"
	"testing"
)

const idl = `{"idl_filename": "test","idl_extension": ".proto","idl_filename_with_extension": "test.proto","idl_full_path": "","modules": [{"name": "Service1","target_language": "go","comment": "Comments for Service1\n","tags": {"openffi_function_path": "package=main","openffi_target_language": "go"},"functions": [{"name": "f1","comment": "F1 comment\nparam1 comment\n","tags": {"openffi_function_path": "function=F1"},"path_to_foreign_function": {"module": "/home/tcs/src/github.com/OpenFFI/lang-plugin-go/test","package": "GoFuncs","function": "F1"},"parameter_type": "Params1","return_values_type": "Return1","parameters": [{"name": "p1","type": "string","comment": "Params1 array of strings\n","tags": null,"is_array": true,"pass_method": ""}],"return_values": [{"name": "r1","type": "string","comment": "Return1 string\n","tags": null,"is_array": false,"pass_method": ""}]}]}]}`
const serializationCode = `{"Service1/Test.java":"// Generated by the protocol buffer compiler.  DO NOT EDIT!\n// source: test\n\npublic final class Test {\n  private Test() {}\n  public static void registerAllExtensions(\n      com.google.protobuf.ExtensionRegistryLite registry) {\n  }\n\n  public static void registerAllExtensions(\n      com.google.protobuf.ExtensionRegistry registry) {\n    registerAllExtensions(\n        (com.google.protobuf.ExtensionRegistryLite) registry);\n  }\n  public interface Return1OrBuilder extends\n      // @@protoc_insertion_point(interface_extends:Return1)\n      com.google.protobuf.MessageOrBuilder {\n\n    /**\n     * \u003ccode\u003estring r1 = 1;\u003c/code\u003e\n     * @return The r1.\n     */\n    java.lang.String getR1();\n    /**\n     * \u003ccode\u003estring r1 = 1;\u003c/code\u003e\n     * @return The bytes for r1.\n     */\n    com.google.protobuf.ByteString\n        getR1Bytes();\n  }\n  /**\n   * Protobuf type {@code Return1}\n   */\n  public static final class Return1 extends\n      com.google.protobuf.GeneratedMessageV3 implements\n      // @@protoc_insertion_point(message_implements:Return1)\n      Return1OrBuilder {\n  private static final long serialVersionUID = 0L;\n    // Use Return1.newBuilder() to construct.\n    private Return1(com.google.protobuf.GeneratedMessageV3.Builder\u003c?\u003e builder) {\n      super(builder);\n    }\n    private Return1() {\n      r1_ = \"\";\n    }\n\n    @java.lang.Override\n    @SuppressWarnings({\"unused\"})\n    protected java.lang.Object newInstance(\n        UnusedPrivateParameter unused) {\n      return new Return1();\n    }\n\n    @java.lang.Override\n    public final com.google.protobuf.UnknownFieldSet\n    getUnknownFields() {\n      return this.unknownFields;\n    }\n    private Return1(\n        com.google.protobuf.CodedInputStream input,\n        com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n        throws com.google.protobuf.InvalidProtocolBufferException {\n      this();\n      if (extensionRegistry == null) {\n        throw new java.lang.NullPointerException();\n      }\n      com.google.protobuf.UnknownFieldSet.Builder unknownFields =\n          com.google.protobuf.UnknownFieldSet.newBuilder();\n      try {\n        boolean done = false;\n        while (!done) {\n          int tag = input.readTag();\n          switch (tag) {\n            case 0:\n              done = true;\n              break;\n            case 10: {\n              java.lang.String s = input.readStringRequireUtf8();\n\n              r1_ = s;\n              break;\n            }\n            default: {\n              if (!parseUnknownField(\n                  input, unknownFields, extensionRegistry, tag)) {\n                done = true;\n              }\n              break;\n            }\n          }\n        }\n      } catch (com.google.protobuf.InvalidProtocolBufferException e) {\n        throw e.setUnfinishedMessage(this);\n      } catch (java.io.IOException e) {\n        throw new com.google.protobuf.InvalidProtocolBufferException(\n            e).setUnfinishedMessage(this);\n      } finally {\n        this.unknownFields = unknownFields.build();\n        makeExtensionsImmutable();\n      }\n    }\n    public static final com.google.protobuf.Descriptors.Descriptor\n        getDescriptor() {\n      return Test.internal_static_Return1_descriptor;\n    }\n\n    @java.lang.Override\n    protected com.google.protobuf.GeneratedMessageV3.FieldAccessorTable\n        internalGetFieldAccessorTable() {\n      return Test.internal_static_Return1_fieldAccessorTable\n          .ensureFieldAccessorsInitialized(\n              Test.Return1.class, Test.Return1.Builder.class);\n    }\n\n    public static final int R1_FIELD_NUMBER = 1;\n    private volatile java.lang.Object r1_;\n    /**\n     * \u003ccode\u003estring r1 = 1;\u003c/code\u003e\n     * @return The r1.\n     */\n    @java.lang.Override\n    public java.lang.String getR1() {\n      java.lang.Object ref = r1_;\n      if (ref instanceof java.lang.String) {\n        return (java.lang.String) ref;\n      } else {\n        com.google.protobuf.ByteString bs = \n            (com.google.protobuf.ByteString) ref;\n        java.lang.String s = bs.toStringUtf8();\n        r1_ = s;\n        return s;\n      }\n    }\n    /**\n     * \u003ccode\u003estring r1 = 1;\u003c/code\u003e\n     * @return The bytes for r1.\n     */\n    @java.lang.Override\n    public com.google.protobuf.ByteString\n        getR1Bytes() {\n      java.lang.Object ref = r1_;\n      if (ref instanceof java.lang.String) {\n        com.google.protobuf.ByteString b = \n            com.google.protobuf.ByteString.copyFromUtf8(\n                (java.lang.String) ref);\n        r1_ = b;\n        return b;\n      } else {\n        return (com.google.protobuf.ByteString) ref;\n      }\n    }\n\n    private byte memoizedIsInitialized = -1;\n    @java.lang.Override\n    public final boolean isInitialized() {\n      byte isInitialized = memoizedIsInitialized;\n      if (isInitialized == 1) return true;\n      if (isInitialized == 0) return false;\n\n      memoizedIsInitialized = 1;\n      return true;\n    }\n\n    @java.lang.Override\n    public void writeTo(com.google.protobuf.CodedOutputStream output)\n                        throws java.io.IOException {\n      if (!getR1Bytes().isEmpty()) {\n        com.google.protobuf.GeneratedMessageV3.writeString(output, 1, r1_);\n      }\n      unknownFields.writeTo(output);\n    }\n\n    @java.lang.Override\n    public int getSerializedSize() {\n      int size = memoizedSize;\n      if (size != -1) return size;\n\n      size = 0;\n      if (!getR1Bytes().isEmpty()) {\n        size += com.google.protobuf.GeneratedMessageV3.computeStringSize(1, r1_);\n      }\n      size += unknownFields.getSerializedSize();\n      memoizedSize = size;\n      return size;\n    }\n\n    @java.lang.Override\n    public boolean equals(final java.lang.Object obj) {\n      if (obj == this) {\n       return true;\n      }\n      if (!(obj instanceof Test.Return1)) {\n        return super.equals(obj);\n      }\n      Test.Return1 other = (Test.Return1) obj;\n\n      if (!getR1()\n          .equals(other.getR1())) return false;\n      if (!unknownFields.equals(other.unknownFields)) return false;\n      return true;\n    }\n\n    @java.lang.Override\n    public int hashCode() {\n      if (memoizedHashCode != 0) {\n        return memoizedHashCode;\n      }\n      int hash = 41;\n      hash = (19 * hash) + getDescriptor().hashCode();\n      hash = (37 * hash) + R1_FIELD_NUMBER;\n      hash = (53 * hash) + getR1().hashCode();\n      hash = (29 * hash) + unknownFields.hashCode();\n      memoizedHashCode = hash;\n      return hash;\n    }\n\n    public static Test.Return1 parseFrom(\n        java.nio.ByteBuffer data)\n        throws com.google.protobuf.InvalidProtocolBufferException {\n      return PARSER.parseFrom(data);\n    }\n    public static Test.Return1 parseFrom(\n        java.nio.ByteBuffer data,\n        com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n        throws com.google.protobuf.InvalidProtocolBufferException {\n      return PARSER.parseFrom(data, extensionRegistry);\n    }\n    public static Test.Return1 parseFrom(\n        com.google.protobuf.ByteString data)\n        throws com.google.protobuf.InvalidProtocolBufferException {\n      return PARSER.parseFrom(data);\n    }\n    public static Test.Return1 parseFrom(\n        com.google.protobuf.ByteString data,\n        com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n        throws com.google.protobuf.InvalidProtocolBufferException {\n      return PARSER.parseFrom(data, extensionRegistry);\n    }\n    public static Test.Return1 parseFrom(byte[] data)\n        throws com.google.protobuf.InvalidProtocolBufferException {\n      return PARSER.parseFrom(data);\n    }\n    public static Test.Return1 parseFrom(\n        byte[] data,\n        com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n        throws com.google.protobuf.InvalidProtocolBufferException {\n      return PARSER.parseFrom(data, extensionRegistry);\n    }\n    public static Test.Return1 parseFrom(java.io.InputStream input)\n        throws java.io.IOException {\n      return com.google.protobuf.GeneratedMessageV3\n          .parseWithIOException(PARSER, input);\n    }\n    public static Test.Return1 parseFrom(\n        java.io.InputStream input,\n        com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n        throws java.io.IOException {\n      return com.google.protobuf.GeneratedMessageV3\n          .parseWithIOException(PARSER, input, extensionRegistry);\n    }\n    public static Test.Return1 parseDelimitedFrom(java.io.InputStream input)\n        throws java.io.IOException {\n      return com.google.protobuf.GeneratedMessageV3\n          .parseDelimitedWithIOException(PARSER, input);\n    }\n    public static Test.Return1 parseDelimitedFrom(\n        java.io.InputStream input,\n        com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n        throws java.io.IOException {\n      return com.google.protobuf.GeneratedMessageV3\n          .parseDelimitedWithIOException(PARSER, input, extensionRegistry);\n    }\n    public static Test.Return1 parseFrom(\n        com.google.protobuf.CodedInputStream input)\n        throws java.io.IOException {\n      return com.google.protobuf.GeneratedMessageV3\n          .parseWithIOException(PARSER, input);\n    }\n    public static Test.Return1 parseFrom(\n        com.google.protobuf.CodedInputStream input,\n        com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n        throws java.io.IOException {\n      return com.google.protobuf.GeneratedMessageV3\n          .parseWithIOException(PARSER, input, extensionRegistry);\n    }\n\n    @java.lang.Override\n    public Builder newBuilderForType() { return newBuilder(); }\n    public static Builder newBuilder() {\n      return DEFAULT_INSTANCE.toBuilder();\n    }\n    public static Builder newBuilder(Test.Return1 prototype) {\n      return DEFAULT_INSTANCE.toBuilder().mergeFrom(prototype);\n    }\n    @java.lang.Override\n    public Builder toBuilder() {\n      return this == DEFAULT_INSTANCE\n          ? new Builder() : new Builder().mergeFrom(this);\n    }\n\n    @java.lang.Override\n    protected Builder newBuilderForType(\n        com.google.protobuf.GeneratedMessageV3.BuilderParent parent) {\n      Builder builder = new Builder(parent);\n      return builder;\n    }\n    /**\n     * Protobuf type {@code Return1}\n     */\n    public static final class Builder extends\n        com.google.protobuf.GeneratedMessageV3.Builder\u003cBuilder\u003e implements\n        // @@protoc_insertion_point(builder_implements:Return1)\n        Test.Return1OrBuilder {\n      public static final com.google.protobuf.Descriptors.Descriptor\n          getDescriptor() {\n        return Test.internal_static_Return1_descriptor;\n      }\n\n      @java.lang.Override\n      protected com.google.protobuf.GeneratedMessageV3.FieldAccessorTable\n          internalGetFieldAccessorTable() {\n        return Test.internal_static_Return1_fieldAccessorTable\n            .ensureFieldAccessorsInitialized(\n                Test.Return1.class, Test.Return1.Builder.class);\n      }\n\n      // Construct using Test.Return1.newBuilder()\n      private Builder() {\n        maybeForceBuilderInitialization();\n      }\n\n      private Builder(\n          com.google.protobuf.GeneratedMessageV3.BuilderParent parent) {\n        super(parent);\n        maybeForceBuilderInitialization();\n      }\n      private void maybeForceBuilderInitialization() {\n        if (com.google.protobuf.GeneratedMessageV3\n                .alwaysUseFieldBuilders) {\n        }\n      }\n      @java.lang.Override\n      public Builder clear() {\n        super.clear();\n        r1_ = \"\";\n\n        return this;\n      }\n\n      @java.lang.Override\n      public com.google.protobuf.Descriptors.Descriptor\n          getDescriptorForType() {\n        return Test.internal_static_Return1_descriptor;\n      }\n\n      @java.lang.Override\n      public Test.Return1 getDefaultInstanceForType() {\n        return Test.Return1.getDefaultInstance();\n      }\n\n      @java.lang.Override\n      public Test.Return1 build() {\n        Test.Return1 result = buildPartial();\n        if (!result.isInitialized()) {\n          throw newUninitializedMessageException(result);\n        }\n        return result;\n      }\n\n      @java.lang.Override\n      public Test.Return1 buildPartial() {\n        Test.Return1 result = new Test.Return1(this);\n        result.r1_ = r1_;\n        onBuilt();\n        return result;\n      }\n\n      @java.lang.Override\n      public Builder clone() {\n        return super.clone();\n      }\n      @java.lang.Override\n      public Builder setField(\n          com.google.protobuf.Descriptors.FieldDescriptor field,\n          java.lang.Object value) {\n        return super.setField(field, value);\n      }\n      @java.lang.Override\n      public Builder clearField(\n          com.google.protobuf.Descriptors.FieldDescriptor field) {\n        return super.clearField(field);\n      }\n      @java.lang.Override\n      public Builder clearOneof(\n          com.google.protobuf.Descriptors.OneofDescriptor oneof) {\n        return super.clearOneof(oneof);\n      }\n      @java.lang.Override\n      public Builder setRepeatedField(\n          com.google.protobuf.Descriptors.FieldDescriptor field,\n          int index, java.lang.Object value) {\n        return super.setRepeatedField(field, index, value);\n      }\n      @java.lang.Override\n      public Builder addRepeatedField(\n          com.google.protobuf.Descriptors.FieldDescriptor field,\n          java.lang.Object value) {\n        return super.addRepeatedField(field, value);\n      }\n      @java.lang.Override\n      public Builder mergeFrom(com.google.protobuf.Message other) {\n        if (other instanceof Test.Return1) {\n          return mergeFrom((Test.Return1)other);\n        } else {\n          super.mergeFrom(other);\n          return this;\n        }\n      }\n\n      public Builder mergeFrom(Test.Return1 other) {\n        if (other == Test.Return1.getDefaultInstance()) return this;\n        if (!other.getR1().isEmpty()) {\n          r1_ = other.r1_;\n          onChanged();\n        }\n        this.mergeUnknownFields(other.unknownFields);\n        onChanged();\n        return this;\n      }\n\n      @java.lang.Override\n      public final boolean isInitialized() {\n        return true;\n      }\n\n      @java.lang.Override\n      public Builder mergeFrom(\n          com.google.protobuf.CodedInputStream input,\n          com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n          throws java.io.IOException {\n        Test.Return1 parsedMessage = null;\n        try {\n          parsedMessage = PARSER.parsePartialFrom(input, extensionRegistry);\n        } catch (com.google.protobuf.InvalidProtocolBufferException e) {\n          parsedMessage = (Test.Return1) e.getUnfinishedMessage();\n          throw e.unwrapIOException();\n        } finally {\n          if (parsedMessage != null) {\n            mergeFrom(parsedMessage);\n          }\n        }\n        return this;\n      }\n\n      private java.lang.Object r1_ = \"\";\n      /**\n       * \u003ccode\u003estring r1 = 1;\u003c/code\u003e\n       * @return The r1.\n       */\n      public java.lang.String getR1() {\n        java.lang.Object ref = r1_;\n        if (!(ref instanceof java.lang.String)) {\n          com.google.protobuf.ByteString bs =\n              (com.google.protobuf.ByteString) ref;\n          java.lang.String s = bs.toStringUtf8();\n          r1_ = s;\n          return s;\n        } else {\n          return (java.lang.String) ref;\n        }\n      }\n      /**\n       * \u003ccode\u003estring r1 = 1;\u003c/code\u003e\n       * @return The bytes for r1.\n       */\n      public com.google.protobuf.ByteString\n          getR1Bytes() {\n        java.lang.Object ref = r1_;\n        if (ref instanceof String) {\n          com.google.protobuf.ByteString b = \n              com.google.protobuf.ByteString.copyFromUtf8(\n                  (java.lang.String) ref);\n          r1_ = b;\n          return b;\n        } else {\n          return (com.google.protobuf.ByteString) ref;\n        }\n      }\n      /**\n       * \u003ccode\u003estring r1 = 1;\u003c/code\u003e\n       * @param value The r1 to set.\n       * @return This builder for chaining.\n       */\n      public Builder setR1(\n          java.lang.String value) {\n        if (value == null) {\n    throw new NullPointerException();\n  }\n  \n        r1_ = value;\n        onChanged();\n        return this;\n      }\n      /**\n       * \u003ccode\u003estring r1 = 1;\u003c/code\u003e\n       * @return This builder for chaining.\n       */\n      public Builder clearR1() {\n        \n        r1_ = getDefaultInstance().getR1();\n        onChanged();\n        return this;\n      }\n      /**\n       * \u003ccode\u003estring r1 = 1;\u003c/code\u003e\n       * @param value The bytes for r1 to set.\n       * @return This builder for chaining.\n       */\n      public Builder setR1Bytes(\n          com.google.protobuf.ByteString value) {\n        if (value == null) {\n    throw new NullPointerException();\n  }\n  checkByteStringIsUtf8(value);\n        \n        r1_ = value;\n        onChanged();\n        return this;\n      }\n      @java.lang.Override\n      public final Builder setUnknownFields(\n          final com.google.protobuf.UnknownFieldSet unknownFields) {\n        return super.setUnknownFields(unknownFields);\n      }\n\n      @java.lang.Override\n      public final Builder mergeUnknownFields(\n          final com.google.protobuf.UnknownFieldSet unknownFields) {\n        return super.mergeUnknownFields(unknownFields);\n      }\n\n\n      // @@protoc_insertion_point(builder_scope:Return1)\n    }\n\n    // @@protoc_insertion_point(class_scope:Return1)\n    private static final Test.Return1 DEFAULT_INSTANCE;\n    static {\n      DEFAULT_INSTANCE = new Test.Return1();\n    }\n\n    public static Test.Return1 getDefaultInstance() {\n      return DEFAULT_INSTANCE;\n    }\n\n    private static final com.google.protobuf.Parser\u003cReturn1\u003e\n        PARSER = new com.google.protobuf.AbstractParser\u003cReturn1\u003e() {\n      @java.lang.Override\n      public Return1 parsePartialFrom(\n          com.google.protobuf.CodedInputStream input,\n          com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n          throws com.google.protobuf.InvalidProtocolBufferException {\n        return new Return1(input, extensionRegistry);\n      }\n    };\n\n    public static com.google.protobuf.Parser\u003cReturn1\u003e parser() {\n      return PARSER;\n    }\n\n    @java.lang.Override\n    public com.google.protobuf.Parser\u003cReturn1\u003e getParserForType() {\n      return PARSER;\n    }\n\n    @java.lang.Override\n    public Test.Return1 getDefaultInstanceForType() {\n      return DEFAULT_INSTANCE;\n    }\n\n  }\n\n  public interface Params1OrBuilder extends\n      // @@protoc_insertion_point(interface_extends:Params1)\n      com.google.protobuf.MessageOrBuilder {\n\n    /**\n     * \u003ccode\u003erepeated string p1 = 1;\u003c/code\u003e\n     * @return A list containing the p1.\n     */\n    java.util.List\u003cjava.lang.String\u003e\n        getP1List();\n    /**\n     * \u003ccode\u003erepeated string p1 = 1;\u003c/code\u003e\n     * @return The count of p1.\n     */\n    int getP1Count();\n    /**\n     * \u003ccode\u003erepeated string p1 = 1;\u003c/code\u003e\n     * @param index The index of the element to return.\n     * @return The p1 at the given index.\n     */\n    java.lang.String getP1(int index);\n    /**\n     * \u003ccode\u003erepeated string p1 = 1;\u003c/code\u003e\n     * @param index The index of the value to return.\n     * @return The bytes of the p1 at the given index.\n     */\n    com.google.protobuf.ByteString\n        getP1Bytes(int index);\n  }\n  /**\n   * Protobuf type {@code Params1}\n   */\n  public static final class Params1 extends\n      com.google.protobuf.GeneratedMessageV3 implements\n      // @@protoc_insertion_point(message_implements:Params1)\n      Params1OrBuilder {\n  private static final long serialVersionUID = 0L;\n    // Use Params1.newBuilder() to construct.\n    private Params1(com.google.protobuf.GeneratedMessageV3.Builder\u003c?\u003e builder) {\n      super(builder);\n    }\n    private Params1() {\n      p1_ = com.google.protobuf.LazyStringArrayList.EMPTY;\n    }\n\n    @java.lang.Override\n    @SuppressWarnings({\"unused\"})\n    protected java.lang.Object newInstance(\n        UnusedPrivateParameter unused) {\n      return new Params1();\n    }\n\n    @java.lang.Override\n    public final com.google.protobuf.UnknownFieldSet\n    getUnknownFields() {\n      return this.unknownFields;\n    }\n    private Params1(\n        com.google.protobuf.CodedInputStream input,\n        com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n        throws com.google.protobuf.InvalidProtocolBufferException {\n      this();\n      if (extensionRegistry == null) {\n        throw new java.lang.NullPointerException();\n      }\n      int mutable_bitField0_ = 0;\n      com.google.protobuf.UnknownFieldSet.Builder unknownFields =\n          com.google.protobuf.UnknownFieldSet.newBuilder();\n      try {\n        boolean done = false;\n        while (!done) {\n          int tag = input.readTag();\n          switch (tag) {\n            case 0:\n              done = true;\n              break;\n            case 10: {\n              java.lang.String s = input.readStringRequireUtf8();\n              if (!((mutable_bitField0_ \u0026 0x00000001) != 0)) {\n                p1_ = new com.google.protobuf.LazyStringArrayList();\n                mutable_bitField0_ |= 0x00000001;\n              }\n              p1_.add(s);\n              break;\n            }\n            default: {\n              if (!parseUnknownField(\n                  input, unknownFields, extensionRegistry, tag)) {\n                done = true;\n              }\n              break;\n            }\n          }\n        }\n      } catch (com.google.protobuf.InvalidProtocolBufferException e) {\n        throw e.setUnfinishedMessage(this);\n      } catch (java.io.IOException e) {\n        throw new com.google.protobuf.InvalidProtocolBufferException(\n            e).setUnfinishedMessage(this);\n      } finally {\n        if (((mutable_bitField0_ \u0026 0x00000001) != 0)) {\n          p1_ = p1_.getUnmodifiableView();\n        }\n        this.unknownFields = unknownFields.build();\n        makeExtensionsImmutable();\n      }\n    }\n    public static final com.google.protobuf.Descriptors.Descriptor\n        getDescriptor() {\n      return Test.internal_static_Params1_descriptor;\n    }\n\n    @java.lang.Override\n    protected com.google.protobuf.GeneratedMessageV3.FieldAccessorTable\n        internalGetFieldAccessorTable() {\n      return Test.internal_static_Params1_fieldAccessorTable\n          .ensureFieldAccessorsInitialized(\n              Test.Params1.class, Test.Params1.Builder.class);\n    }\n\n    public static final int P1_FIELD_NUMBER = 1;\n    private com.google.protobuf.LazyStringList p1_;\n    /**\n     * \u003ccode\u003erepeated string p1 = 1;\u003c/code\u003e\n     * @return A list containing the p1.\n     */\n    public com.google.protobuf.ProtocolStringList\n        getP1List() {\n      return p1_;\n    }\n    /**\n     * \u003ccode\u003erepeated string p1 = 1;\u003c/code\u003e\n     * @return The count of p1.\n     */\n    public int getP1Count() {\n      return p1_.size();\n    }\n    /**\n     * \u003ccode\u003erepeated string p1 = 1;\u003c/code\u003e\n     * @param index The index of the element to return.\n     * @return The p1 at the given index.\n     */\n    public java.lang.String getP1(int index) {\n      return p1_.get(index);\n    }\n    /**\n     * \u003ccode\u003erepeated string p1 = 1;\u003c/code\u003e\n     * @param index The index of the value to return.\n     * @return The bytes of the p1 at the given index.\n     */\n    public com.google.protobuf.ByteString\n        getP1Bytes(int index) {\n      return p1_.getByteString(index);\n    }\n\n    private byte memoizedIsInitialized = -1;\n    @java.lang.Override\n    public final boolean isInitialized() {\n      byte isInitialized = memoizedIsInitialized;\n      if (isInitialized == 1) return true;\n      if (isInitialized == 0) return false;\n\n      memoizedIsInitialized = 1;\n      return true;\n    }\n\n    @java.lang.Override\n    public void writeTo(com.google.protobuf.CodedOutputStream output)\n                        throws java.io.IOException {\n      for (int i = 0; i \u003c p1_.size(); i++) {\n        com.google.protobuf.GeneratedMessageV3.writeString(output, 1, p1_.getRaw(i));\n      }\n      unknownFields.writeTo(output);\n    }\n\n    @java.lang.Override\n    public int getSerializedSize() {\n      int size = memoizedSize;\n      if (size != -1) return size;\n\n      size = 0;\n      {\n        int dataSize = 0;\n        for (int i = 0; i \u003c p1_.size(); i++) {\n          dataSize += computeStringSizeNoTag(p1_.getRaw(i));\n        }\n        size += dataSize;\n        size += 1 * getP1List().size();\n      }\n      size += unknownFields.getSerializedSize();\n      memoizedSize = size;\n      return size;\n    }\n\n    @java.lang.Override\n    public boolean equals(final java.lang.Object obj) {\n      if (obj == this) {\n       return true;\n      }\n      if (!(obj instanceof Test.Params1)) {\n        return super.equals(obj);\n      }\n      Test.Params1 other = (Test.Params1) obj;\n\n      if (!getP1List()\n          .equals(other.getP1List())) return false;\n      if (!unknownFields.equals(other.unknownFields)) return false;\n      return true;\n    }\n\n    @java.lang.Override\n    public int hashCode() {\n      if (memoizedHashCode != 0) {\n        return memoizedHashCode;\n      }\n      int hash = 41;\n      hash = (19 * hash) + getDescriptor().hashCode();\n      if (getP1Count() \u003e 0) {\n        hash = (37 * hash) + P1_FIELD_NUMBER;\n        hash = (53 * hash) + getP1List().hashCode();\n      }\n      hash = (29 * hash) + unknownFields.hashCode();\n      memoizedHashCode = hash;\n      return hash;\n    }\n\n    public static Test.Params1 parseFrom(\n        java.nio.ByteBuffer data)\n        throws com.google.protobuf.InvalidProtocolBufferException {\n      return PARSER.parseFrom(data);\n    }\n    public static Test.Params1 parseFrom(\n        java.nio.ByteBuffer data,\n        com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n        throws com.google.protobuf.InvalidProtocolBufferException {\n      return PARSER.parseFrom(data, extensionRegistry);\n    }\n    public static Test.Params1 parseFrom(\n        com.google.protobuf.ByteString data)\n        throws com.google.protobuf.InvalidProtocolBufferException {\n      return PARSER.parseFrom(data);\n    }\n    public static Test.Params1 parseFrom(\n        com.google.protobuf.ByteString data,\n        com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n        throws com.google.protobuf.InvalidProtocolBufferException {\n      return PARSER.parseFrom(data, extensionRegistry);\n    }\n    public static Test.Params1 parseFrom(byte[] data)\n        throws com.google.protobuf.InvalidProtocolBufferException {\n      return PARSER.parseFrom(data);\n    }\n    public static Test.Params1 parseFrom(\n        byte[] data,\n        com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n        throws com.google.protobuf.InvalidProtocolBufferException {\n      return PARSER.parseFrom(data, extensionRegistry);\n    }\n    public static Test.Params1 parseFrom(java.io.InputStream input)\n        throws java.io.IOException {\n      return com.google.protobuf.GeneratedMessageV3\n          .parseWithIOException(PARSER, input);\n    }\n    public static Test.Params1 parseFrom(\n        java.io.InputStream input,\n        com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n        throws java.io.IOException {\n      return com.google.protobuf.GeneratedMessageV3\n          .parseWithIOException(PARSER, input, extensionRegistry);\n    }\n    public static Test.Params1 parseDelimitedFrom(java.io.InputStream input)\n        throws java.io.IOException {\n      return com.google.protobuf.GeneratedMessageV3\n          .parseDelimitedWithIOException(PARSER, input);\n    }\n    public static Test.Params1 parseDelimitedFrom(\n        java.io.InputStream input,\n        com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n        throws java.io.IOException {\n      return com.google.protobuf.GeneratedMessageV3\n          .parseDelimitedWithIOException(PARSER, input, extensionRegistry);\n    }\n    public static Test.Params1 parseFrom(\n        com.google.protobuf.CodedInputStream input)\n        throws java.io.IOException {\n      return com.google.protobuf.GeneratedMessageV3\n          .parseWithIOException(PARSER, input);\n    }\n    public static Test.Params1 parseFrom(\n        com.google.protobuf.CodedInputStream input,\n        com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n        throws java.io.IOException {\n      return com.google.protobuf.GeneratedMessageV3\n          .parseWithIOException(PARSER, input, extensionRegistry);\n    }\n\n    @java.lang.Override\n    public Builder newBuilderForType() { return newBuilder(); }\n    public static Builder newBuilder() {\n      return DEFAULT_INSTANCE.toBuilder();\n    }\n    public static Builder newBuilder(Test.Params1 prototype) {\n      return DEFAULT_INSTANCE.toBuilder().mergeFrom(prototype);\n    }\n    @java.lang.Override\n    public Builder toBuilder() {\n      return this == DEFAULT_INSTANCE\n          ? new Builder() : new Builder().mergeFrom(this);\n    }\n\n    @java.lang.Override\n    protected Builder newBuilderForType(\n        com.google.protobuf.GeneratedMessageV3.BuilderParent parent) {\n      Builder builder = new Builder(parent);\n      return builder;\n    }\n    /**\n     * Protobuf type {@code Params1}\n     */\n    public static final class Builder extends\n        com.google.protobuf.GeneratedMessageV3.Builder\u003cBuilder\u003e implements\n        // @@protoc_insertion_point(builder_implements:Params1)\n        Test.Params1OrBuilder {\n      public static final com.google.protobuf.Descriptors.Descriptor\n          getDescriptor() {\n        return Test.internal_static_Params1_descriptor;\n      }\n\n      @java.lang.Override\n      protected com.google.protobuf.GeneratedMessageV3.FieldAccessorTable\n          internalGetFieldAccessorTable() {\n        return Test.internal_static_Params1_fieldAccessorTable\n            .ensureFieldAccessorsInitialized(\n                Test.Params1.class, Test.Params1.Builder.class);\n      }\n\n      // Construct using Test.Params1.newBuilder()\n      private Builder() {\n        maybeForceBuilderInitialization();\n      }\n\n      private Builder(\n          com.google.protobuf.GeneratedMessageV3.BuilderParent parent) {\n        super(parent);\n        maybeForceBuilderInitialization();\n      }\n      private void maybeForceBuilderInitialization() {\n        if (com.google.protobuf.GeneratedMessageV3\n                .alwaysUseFieldBuilders) {\n        }\n      }\n      @java.lang.Override\n      public Builder clear() {\n        super.clear();\n        p1_ = com.google.protobuf.LazyStringArrayList.EMPTY;\n        bitField0_ = (bitField0_ \u0026 ~0x00000001);\n        return this;\n      }\n\n      @java.lang.Override\n      public com.google.protobuf.Descriptors.Descriptor\n          getDescriptorForType() {\n        return Test.internal_static_Params1_descriptor;\n      }\n\n      @java.lang.Override\n      public Test.Params1 getDefaultInstanceForType() {\n        return Test.Params1.getDefaultInstance();\n      }\n\n      @java.lang.Override\n      public Test.Params1 build() {\n        Test.Params1 result = buildPartial();\n        if (!result.isInitialized()) {\n          throw newUninitializedMessageException(result);\n        }\n        return result;\n      }\n\n      @java.lang.Override\n      public Test.Params1 buildPartial() {\n        Test.Params1 result = new Test.Params1(this);\n        int from_bitField0_ = bitField0_;\n        if (((bitField0_ \u0026 0x00000001) != 0)) {\n          p1_ = p1_.getUnmodifiableView();\n          bitField0_ = (bitField0_ \u0026 ~0x00000001);\n        }\n        result.p1_ = p1_;\n        onBuilt();\n        return result;\n      }\n\n      @java.lang.Override\n      public Builder clone() {\n        return super.clone();\n      }\n      @java.lang.Override\n      public Builder setField(\n          com.google.protobuf.Descriptors.FieldDescriptor field,\n          java.lang.Object value) {\n        return super.setField(field, value);\n      }\n      @java.lang.Override\n      public Builder clearField(\n          com.google.protobuf.Descriptors.FieldDescriptor field) {\n        return super.clearField(field);\n      }\n      @java.lang.Override\n      public Builder clearOneof(\n          com.google.protobuf.Descriptors.OneofDescriptor oneof) {\n        return super.clearOneof(oneof);\n      }\n      @java.lang.Override\n      public Builder setRepeatedField(\n          com.google.protobuf.Descriptors.FieldDescriptor field,\n          int index, java.lang.Object value) {\n        return super.setRepeatedField(field, index, value);\n      }\n      @java.lang.Override\n      public Builder addRepeatedField(\n          com.google.protobuf.Descriptors.FieldDescriptor field,\n          java.lang.Object value) {\n        return super.addRepeatedField(field, value);\n      }\n      @java.lang.Override\n      public Builder mergeFrom(com.google.protobuf.Message other) {\n        if (other instanceof Test.Params1) {\n          return mergeFrom((Test.Params1)other);\n        } else {\n          super.mergeFrom(other);\n          return this;\n        }\n      }\n\n      public Builder mergeFrom(Test.Params1 other) {\n        if (other == Test.Params1.getDefaultInstance()) return this;\n        if (!other.p1_.isEmpty()) {\n          if (p1_.isEmpty()) {\n            p1_ = other.p1_;\n            bitField0_ = (bitField0_ \u0026 ~0x00000001);\n          } else {\n            ensureP1IsMutable();\n            p1_.addAll(other.p1_);\n          }\n          onChanged();\n        }\n        this.mergeUnknownFields(other.unknownFields);\n        onChanged();\n        return this;\n      }\n\n      @java.lang.Override\n      public final boolean isInitialized() {\n        return true;\n      }\n\n      @java.lang.Override\n      public Builder mergeFrom(\n          com.google.protobuf.CodedInputStream input,\n          com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n          throws java.io.IOException {\n        Test.Params1 parsedMessage = null;\n        try {\n          parsedMessage = PARSER.parsePartialFrom(input, extensionRegistry);\n        } catch (com.google.protobuf.InvalidProtocolBufferException e) {\n          parsedMessage = (Test.Params1) e.getUnfinishedMessage();\n          throw e.unwrapIOException();\n        } finally {\n          if (parsedMessage != null) {\n            mergeFrom(parsedMessage);\n          }\n        }\n        return this;\n      }\n      private int bitField0_;\n\n      private com.google.protobuf.LazyStringList p1_ = com.google.protobuf.LazyStringArrayList.EMPTY;\n      private void ensureP1IsMutable() {\n        if (!((bitField0_ \u0026 0x00000001) != 0)) {\n          p1_ = new com.google.protobuf.LazyStringArrayList(p1_);\n          bitField0_ |= 0x00000001;\n         }\n      }\n      /**\n       * \u003ccode\u003erepeated string p1 = 1;\u003c/code\u003e\n       * @return A list containing the p1.\n       */\n      public com.google.protobuf.ProtocolStringList\n          getP1List() {\n        return p1_.getUnmodifiableView();\n      }\n      /**\n       * \u003ccode\u003erepeated string p1 = 1;\u003c/code\u003e\n       * @return The count of p1.\n       */\n      public int getP1Count() {\n        return p1_.size();\n      }\n      /**\n       * \u003ccode\u003erepeated string p1 = 1;\u003c/code\u003e\n       * @param index The index of the element to return.\n       * @return The p1 at the given index.\n       */\n      public java.lang.String getP1(int index) {\n        return p1_.get(index);\n      }\n      /**\n       * \u003ccode\u003erepeated string p1 = 1;\u003c/code\u003e\n       * @param index The index of the value to return.\n       * @return The bytes of the p1 at the given index.\n       */\n      public com.google.protobuf.ByteString\n          getP1Bytes(int index) {\n        return p1_.getByteString(index);\n      }\n      /**\n       * \u003ccode\u003erepeated string p1 = 1;\u003c/code\u003e\n       * @param index The index to set the value at.\n       * @param value The p1 to set.\n       * @return This builder for chaining.\n       */\n      public Builder setP1(\n          int index, java.lang.String value) {\n        if (value == null) {\n    throw new NullPointerException();\n  }\n  ensureP1IsMutable();\n        p1_.set(index, value);\n        onChanged();\n        return this;\n      }\n      /**\n       * \u003ccode\u003erepeated string p1 = 1;\u003c/code\u003e\n       * @param value The p1 to add.\n       * @return This builder for chaining.\n       */\n      public Builder addP1(\n          java.lang.String value) {\n        if (value == null) {\n    throw new NullPointerException();\n  }\n  ensureP1IsMutable();\n        p1_.add(value);\n        onChanged();\n        return this;\n      }\n      /**\n       * \u003ccode\u003erepeated string p1 = 1;\u003c/code\u003e\n       * @param values The p1 to add.\n       * @return This builder for chaining.\n       */\n      public Builder addAllP1(\n          java.lang.Iterable\u003cjava.lang.String\u003e values) {\n        ensureP1IsMutable();\n        com.google.protobuf.AbstractMessageLite.Builder.addAll(\n            values, p1_);\n        onChanged();\n        return this;\n      }\n      /**\n       * \u003ccode\u003erepeated string p1 = 1;\u003c/code\u003e\n       * @return This builder for chaining.\n       */\n      public Builder clearP1() {\n        p1_ = com.google.protobuf.LazyStringArrayList.EMPTY;\n        bitField0_ = (bitField0_ \u0026 ~0x00000001);\n        onChanged();\n        return this;\n      }\n      /**\n       * \u003ccode\u003erepeated string p1 = 1;\u003c/code\u003e\n       * @param value The bytes of the p1 to add.\n       * @return This builder for chaining.\n       */\n      public Builder addP1Bytes(\n          com.google.protobuf.ByteString value) {\n        if (value == null) {\n    throw new NullPointerException();\n  }\n  checkByteStringIsUtf8(value);\n        ensureP1IsMutable();\n        p1_.add(value);\n        onChanged();\n        return this;\n      }\n      @java.lang.Override\n      public final Builder setUnknownFields(\n          final com.google.protobuf.UnknownFieldSet unknownFields) {\n        return super.setUnknownFields(unknownFields);\n      }\n\n      @java.lang.Override\n      public final Builder mergeUnknownFields(\n          final com.google.protobuf.UnknownFieldSet unknownFields) {\n        return super.mergeUnknownFields(unknownFields);\n      }\n\n\n      // @@protoc_insertion_point(builder_scope:Params1)\n    }\n\n    // @@protoc_insertion_point(class_scope:Params1)\n    private static final Test.Params1 DEFAULT_INSTANCE;\n    static {\n      DEFAULT_INSTANCE = new Test.Params1();\n    }\n\n    public static Test.Params1 getDefaultInstance() {\n      return DEFAULT_INSTANCE;\n    }\n\n    private static final com.google.protobuf.Parser\u003cParams1\u003e\n        PARSER = new com.google.protobuf.AbstractParser\u003cParams1\u003e() {\n      @java.lang.Override\n      public Params1 parsePartialFrom(\n          com.google.protobuf.CodedInputStream input,\n          com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n          throws com.google.protobuf.InvalidProtocolBufferException {\n        return new Params1(input, extensionRegistry);\n      }\n    };\n\n    public static com.google.protobuf.Parser\u003cParams1\u003e parser() {\n      return PARSER;\n    }\n\n    @java.lang.Override\n    public com.google.protobuf.Parser\u003cParams1\u003e getParserForType() {\n      return PARSER;\n    }\n\n    @java.lang.Override\n    public Test.Params1 getDefaultInstanceForType() {\n      return DEFAULT_INSTANCE;\n    }\n\n  }\n\n  private static final com.google.protobuf.Descriptors.Descriptor\n    internal_static_Return1_descriptor;\n  private static final \n    com.google.protobuf.GeneratedMessageV3.FieldAccessorTable\n      internal_static_Return1_fieldAccessorTable;\n  private static final com.google.protobuf.Descriptors.Descriptor\n    internal_static_Params1_descriptor;\n  private static final \n    com.google.protobuf.GeneratedMessageV3.FieldAccessorTable\n      internal_static_Params1_fieldAccessorTable;\n\n  public static com.google.protobuf.Descriptors.FileDescriptor\n      getDescriptor() {\n    return descriptor;\n  }\n  private static  com.google.protobuf.Descriptors.FileDescriptor\n      descriptor;\n  static {\n    java.lang.String[] descriptorData = {\n      \"\\n\\004test\\\"\\025\\n\\007Return1\\022\\n\\n\\002r1\\030\\001 \\001(\\t\\\"\\025\\n\\007Params1\" +\n      \"\\022\\n\\n\\002p1\\030\\001 \\003(\\tB\\006Z\\004mainb\\006proto3\"\n    };\n    descriptor = com.google.protobuf.Descriptors.FileDescriptor\n      .internalBuildGeneratedFileFrom(descriptorData,\n        new com.google.protobuf.Descriptors.FileDescriptor[] {\n        });\n    internal_static_Return1_descriptor =\n      getDescriptor().getMessageTypes().get(0);\n    internal_static_Return1_fieldAccessorTable = new\n      com.google.protobuf.GeneratedMessageV3.FieldAccessorTable(\n        internal_static_Return1_descriptor,\n        new java.lang.String[] { \"R1\", });\n    internal_static_Params1_descriptor =\n      getDescriptor().getMessageTypes().get(1);\n    internal_static_Params1_fieldAccessorTable = new\n      com.google.protobuf.GeneratedMessageV3.FieldAccessorTable(\n        internal_static_Params1_descriptor,\n        new java.lang.String[] { \"P1\", });\n  }\n\n  // @@protoc_insertion_point(outer_class_scope)\n}\n","Service1/test":"syntax = \"proto3\";\noption go_package = \"main\";\nmessage Return1\n{\n  \tstring r1 = 1;\n}\n\nmessage Params1\n{\n  \trepeated string p1 = 1;\n}\n"}`


//--------------------------------------------------------------------
func TestGuest(t *testing.T){

	def, err := compiler.NewIDLDefinition(idl)
	if err != nil{
		t.Fatal(err)
		return
	}

	serializationCodeMap := make(map[string]string)
	err = json.Unmarshal([]byte(serializationCode), &serializationCodeMap)
	if err != nil{
		t.Fatal(err)
		return
	}

	cmp := NewCompiler(def, serializationCodeMap, ".")
	outputFileName, err := cmp.CompileGuest()
	if err != nil{
		t.Fatal(err)
		return
	}

	err = os.Remove(outputFileName)
	if err != nil{
		t.Fatal(err)
		return
	}

}
//--------------------------------------------------------------------
func TestHost(t *testing.T){

	def, err := compiler.NewIDLDefinition(idl)
	if err != nil{
		t.Fatal(err)
		return
	}

	serializationCodeMap := make(map[string]string)
	err = json.Unmarshal([]byte(serializationCode), &serializationCodeMap)
	if err != nil{
		t.Fatal(err)
		return
	}


	cmp := NewCompiler(def, serializationCodeMap, ".")
	outputFileName, err := cmp.CompileHost(nil)
	if err != nil{
		t.Fatal(err)
		return
	}

	err = os.Remove(outputFileName)
	if err != nil{
		t.Fatal(err)
		return
	}

}
//--------------------------------------------------------------------